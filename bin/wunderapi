#!/usr/bin/env node

var WunderAPI = require('wunderapi')

var params = process.argv.slice(2)
var options = { serial: true }

while (params[0] && params[0][0] && params[0][0] == '-') { // option flag
    for (var opt = params.shift(); opt = opt.slice(1); ) {
        switch (opt[0]) {
            case 'v':
                console.log(WunderAPI.getVersion())
                break
            case 'p':
                options.serial = false
                break
            case 's':
                options.serial = true
                break
            default:
                console.log("Unrecognized option: -" + opt[0])
        }
    }
}

options.root = params.shift()

function runNext() {
    var api = new WunderAPI(options.root)
    if (params.length < 1) return
    api.compileFile(params.shift(), function(err, vows) {
        if (err) throw(err)

        vows.reporter = require('vows/lib/vows/reporters/spec')

        if (options.serial) {
            vows.run(null, function(err, success) {
                runNext()
            })
        } else {
            vows.run()
        }
    })
}

if (options.serial) {
    runNext() 
} else {
    while (params.length) {
        runNext()
    }
}

